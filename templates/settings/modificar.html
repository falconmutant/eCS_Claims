{% extends 'base.html' %}
{% load staticfiles %}
{% block title %}
  eCS Claims
{% endblock title %}

{% block css %}
  <link type="text/css" href="{% static "css/pnotify.css" %}" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.2-rc.1/css/select2.min.css" rel="stylesheet" />
  <style type="text/css">
    #footer {
        padding: 4em 0 6em 0;
        text-align: center;
    }
    #footer .copyright {
        color: #999;
        font-size: 0.9em;
        line-height: 1em;
        margin: 2em 0 0 0;
        padding: 0;
        text-align: center;
    }
    #footer .copyright li {
        display: inline-block;
        list-style: none;
        margin-left: 1em;
        padding-left: 1em;
    }
    .col-md-2{
      width:13.666667%;
    }
    .right{
      margin-left: 90%;
    }
  </style>
{% endblock css %}

{% block header %}
  <div id="jCrumbs" class="breadCrumb module">
    <ul>
      <li>
        <a href="{{ settings.APP_URL }}/logged_in/"><i class="glyphicon glyphicon-home"></i></a>
      </li>
      <li>
        <a href="">Administración</a>
      </li>
      <li>
        <a href="{{ settings.APP_URL }}/lista_usuarios/">Usuarios</a>
      </li>
      <li>
        <a href="">Modificar</a>
      </li>
    </ul>
  </div>
  <div class="row">
    <div class="12u">
      <section class="box">
        <form method="POST" class="form-horizontal">
          {% csrf_token %}
          <center><h3>Registro Usuario Nuevo</h3></center>
          <hr />
            <div class="form-group">
              <label class="col-md-2 control-label">Nombre</label>
              <div class="col-xs-4">
                <div class="input-icon">
                  <input name="nombre" class="input-error form-control" value="{{username.first_name}}">
                </div>
              </div>
              <label class="col-md-2 control-label">Apellidos</label>
              <div class="col-xs-4">
                <div class="input-icon">
                  <input name="apellidos" class="input-error form-control" value="{{username.last_name}}">
                </div>
              </div>
            </div>
            <div class="form-group">
              <label class="col-md-2 control-label">Tipo Usuario</label>
              <div class="col-xs-4">
                <div class="input-icon">
                  <select name="tipo" onchange="tipo_user(this);" class="input-error form-control" required>
                    <option></option>
                    {% for types in tipos %}
                      {% if types.0 == typeUser.tipo %}
                        <option selected="selected" value="{{types.0}}">{{types.1}}</option>
                      {% else %}
                        <option value="{{types.0}}">{{types.1}}</option>
                      {% endif %}
                    {% endfor %}
                  </select>
                </div>
              </div>
              <label class="col-md-2 control-label">Subtipo Usuario</label>
              <div class="col-xs-4">
                <div class="input-icon">
                  <select name="subtipo" onchange="subtipo_user(this);" id="subtipo" class="input-error form-control" >
                    <option value="Q"></option>
                    {% for subtypes in subtipo %}
                      {% if subtypes.0 == typeUser.subtipo %}
                        <option selected="selected" value="{{subtypes.0}}">{{subtypes.1}}</option>
                      {% else %}
                        <option value="{{subtypes.0}}">{{subtypes.1}}</option>
                      {% endif %}
                    {% endfor %}
                  </select>
                </div>
              </div>
            </div>
            <div class="form-group">
              <label class="col-md-2 control-label">Localidad</label>
              <div class="col-xs-4">
                <div class="input-icon">
                  <select name="localidad" onchange="localidades();" id="localidad" class="form-control">
                    <option></option>
                    {% for locality in localidad %}
                      <option value="{{locality.id}}">{{locality.nombre}}</option>
                    {% endfor %}
                  </select>
                </div>
              </div>

              <label class="col-md-2 control-label">Correo</label>
              <div class="col-xs-4">
                <div class="input-icon">
                  <input name="correo" class="input-error form-control" value="{{username.email}}">
                </div>
              </div>
            </div>
            <div class="form-group">
              <label class="col-md-2 control-label">Celular</label>
              <div class="col-xs-4">
                <div class="input-icon">
                  <input name="celular" class="input-error form-control" value="{{typeUser.celular}}">
                </div>
              </div>
              <label class="col-md-2 control-label">Redes Sociales</label>
              <div class="col-xs-4">
                <label class="checkbox-inline icheck">
                  <input name="whatsapp" type="checkbox" id="inlinecheckbox1" value="Y"> Whatsapp
                </label>
                <label class="checkbox-inline icheck">
                  <input name="telegram" type="checkbox" id="inlinecheckbox2" value="Y"> Telegram
                </label>
                <label class="checkbox-inline icheck">
                  <input name="sms" type="checkbox" id="inlinecheckbox3" value="Y"> SMS
                </label>
              </div>
            </div>
          <hr />
            <div class="form-group">
              <label class="col-md-2 control-label">Usuario</label>
              <div class="col-xs-4">
                <div class="input-icon">
                  <input name="user" class="input-error form-control" value="{{username.username}}">
                </div>
              </div>
              <label class="col-md-2 control-label">Contraseña</label>
              <div class="col-xs-4">
                <div class="input-icon">
                  <input type="password" name="pass" class="input-error form-control" required>
                </div>
              </div>
            </div>
            <input name="local" id="local" type="hidden" value="">
          <hr />
          <input type="submit" class="right btn btn-default" value="Modificar">
        </form>
      </section>
    </div>
  </div>
{% endblock header %}
{% block javascript %}
  <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.2-rc.1/js/select2.min.js"></script>
  <script type="text/javascript" src="{% static "js/pnotify.min.js" %}"></script>
  <script type="text/javascript">
    function append_subtypes(value1,value2){
      $('#subtipo').append('<option value="'+value1+'">'+value2+'</option>');
    }

    function localidades(){
      document.getElementById('local').value = ''+$('#localidad').val()+'';
    }

    function subtipo_user(value){
      value = $(value).val();
      console.log(value);
      if (value == 'A') {
        console.log('entra');
        $('#localidad').prop('disabled',false);
        $('#localidad').prop('multiple',false);
        $("#localidad").select2({
          placeholder: "Selecciona la localidad",
          allowClear: true
        });
      }
      else{
        $('#localidad').prop('disabled',false);
        $('#localidad').prop('multiple',true);
        $("#localidad").select2({
          placeholder: "Selecciona las localidades",
        });
      }
    }

    function tipo_user(value){ 
      value = $(value).val();

      if (value == '{{typepmx}}') {
        $('#subtipo').prop('disabled',false);
        $('#localidad').prop('disabled',false);
        $('#subtipo option').remove();
        append_subtypes('Q','');
        {% for subTypePmxs in subTypePmx %}
          append_subtypes('{{subTypePmxs.0}}','{{subTypePmxs.1}}');
        {% endfor %}
      }
      if (value == '{{typemac}}') {
        $('#subtipo').prop('disabled',false);
        $('#localidad').prop('disabled',false);
        $('#subtipo option').remove();
        append_subtypes('Q','');
        {% for subTypeMacs in subTypeMac %}
          append_subtypes('{{subTypeMacs.0}}','{{subTypeMacs.1}}');
        {% endfor %}
      }
      if (value != '{{typemac}}' && value != '{{typepmx}}'){
        $('#subtipo').prop('disabled',true);
        $('#localidad').prop('disabled',true);
        $('#subtipo option').remove();
        append_subtypes('Q','');
      }
    }
    console.log('{{bug}}');
    $(document).ready(function(){
      $("#localidad").select2();
    });
    {% if message_success == 1 %}
      new PNotify({
        title: 'Exito',
        text: 'Usuario modificado con exito!',
        type: 'success',
        styling: 'fontawesome'
      });
    {% endif %}
  </script>
  
{% endblock javascript %}